apiVersion: v1
kind: ConfigMap
metadata:
  name: platformconfig
data:
  clusters.json: |-
    [
        {
            "name": "default",

            "storage": {
                "host": {"mount_path": "/tmp"},
                "url": "http://platformapi/api/v1/storage"
            },

            "registry": {
                "url": "http://localhost:5000",
                "email": "registry@neuromation.io"
            },

            "orchestrator": {
                "kubernetes": {
                    "url": "http://localhost:8001",
                    "ca_data": "certificate",
                    "auth_type": "none",
                    "token": "token",
                    "namespace": "default",

                    "jobs_ingress_name": "not-important",
                    "jobs_ingress_auth_name": "not-important",

                    "node_label_gpu": "not-important",
                    "node_label_preemptible": "not-important"
                },

                "is_http_ingress_secure": false,
                "job_hostname_template": "not-important",
                "named_job_hostname_template": "not-important",

                "resource_pool_types": [
                    {}
                ]
            },

            "ssh": {
                "server": "not-important"
            },

            "monitoring": {
                "url": "not-important",

                "elasticsearch": {
                    "hosts": ["http://elasticsearch-logging.kube-system:9200"]
                }
            }
        }
    ]
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: platformconfig
spec:
  replicas: 1
  selector:
    matchLabels:
      service: platformconfig
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
    type: RollingUpdate
  template:
    metadata:
      labels:
        service: platformconfig
    spec:
      containers:
      - name: platformconfig
        image: platformconfig:latest
        imagePullPolicy: Never
        env:
        - name: NP_AUTH_URL
          value: not-important
        - name: NP_AUTH_TOKEN
          value: not-important
        - name: NP_PUBLIC_NEURO_REGISTRY_URL
          value: not-important
        - name: NP_PUBLIC_NEURO_HELM_URL
          value: not-important
        - name: NP_PLATFORM_URL
          value: not-important
        - name: NP_PLATFORM_API_URL
          value: not-important
        - name: NP_PLATFORM_API_TOKEN
          value: not-important
        - name: NP_AWS_REGION
          value: not-important
        - name: NP_AWS_ACCESS_KEY_ID
          value: not-important
        - name: NP_AWS_SECRET_ACCESS_KEY
          value: not-important
        - name: NP_CLUSTER_DNS_SUFFIX
          value: not-important
        - name: NP_K8S_URL
          value: not-important
        - name: NP_K8S_WORKFLOW_NAMESPACE
          value: not-important
        - name: NP_JOB_FALLBACK_HOSTNAME
          value: not-important
        - name: NP_LATEST_PLATFORM_INFRA_IMAGE_TAG
          value: not-important
        - name: NP_PLATFORM_INFRA_WORKFLOWS_IMAGE_NAME
          value: not-important
        - name: NP_PLATFORM_INFRA_WORKFLOWS_IMAGE_PULL_POLICY
          value: not-important
        - name: NP_API_PORT
          value: "0"
        - name: NP_POSTGRES_HOST
          value: not-important
        - name: NP_POSTGRES_PORT
          value: "0"
        - name: NP_POSTGRES_USERNAME
          value: not-important
        - name: NP_POSTGRES_DB_NAME
          value: not-important
        volumeMounts:
        - name: config-volume
          mountPath: /var/storage/neuromation/clusters
      volumes:
        - name: config-volume
          configMap:
            name: platformconfig
---
apiVersion: v1
kind: Service
metadata:
  name: platformconfig
spec:
  type: ClusterIP
  ports:
  - port: 8080
    targetPort: 8080
  selector:
    service: platformconfig
