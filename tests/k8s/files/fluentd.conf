# TCP input to receive logs from
<source>
    @type forward
    bind 0.0.0.0
    port 24224
</source>

# HTTP input for the liveness and readiness probes
<source>
    @type http
    bind 0.0.0.0
    port 9880
</source>

# Ignore fluentd own events
<match fluent.**>
    @type null
</match>

# Throw the healthcheck to the standard output instead of forwarding it
<match fluentd.healthcheck>
    @type stdout
</match>

# Send the logs to S3
<match **>
    @type s3

    aws_key_id access_key
    aws_sec_key secret_key
    s3_region region-1
    s3_bucket logs
    s3_endpoint http://minio:9000
    force_path_style true

    path ${tag}/
    store_as json
    s3_object_key_format %{path}%{time_slice}_%{index}.%{file_extension}

    <format>
        @type json
    </format>

    <buffer tag,time>
        @type memory

        timekey 1s
        timekey_wait 0
        timekey_use_utc true
    </buffer>
</match>